---
layout: post
title: "Linux中网络设备"
description: ""
category: OpenStack
subtitle:
author: "fishcried"
header-img: "img/bg/home-bg.jpg"
tags: [openstack,网络,neutron]
---

# 1. Bridge

Biridge（桥）是Linux上用来做TCP/IP二层协议交换的设备，与现实世界中的交换机功能相似。Bridge设备实例可以和Linux上其他网络设备实例连接，既attach一个从设备，类似于在现实世界中的交换机和一个用户终端之间连接一根网线。当有数据到达时，Bridge会根据报文中的MAC信息进行广播、转发、丢弃处理。

**常用操作**

	root@ncloud-compute-20:~# brctl 
	Usage: brctl [commands]
	commands:
	        addbr           <bridge>                add bridge
	        delbr           <bridge>                delete bridge
	        addif           <bridge> <device>       add interface to bridge
	        delif           <bridge> <device>       delete interface from bridge
	        hairpin         <bridge> <port> {on|off}        turn hairpin on/off
	        setageing       <bridge> <time>         set ageing time
	        setbridgeprio   <bridge> <prio>         set bridge priority
	        setfd           <bridge> <time>         set bridge forward delay
	        sethello        <bridge> <time>         set hello time
	        setmaxage       <bridge> <time>         set max message age
	        setpathcost     <bridge> <port> <cost>  set path cost
	        setportprio     <bridge> <port> <prio>  set port priority
	        show            [ <bridge> ]            show a list of bridges
	        showmacs        <bridge>                show a list of mac addrs
	        showstp         <bridge>                show bridge stp info

# 2. VLANdevicefor802.1.q

VLAN又称虚拟网络，是一个被广泛使用的概念，有些应用程序把自己的内部网络也称为VLAN。此处主要说的是在物理世界中存在的，需要协议支持的VLAN。它的种类很多，按照协议原理一般分为：MACVLAN、802.1.qVLAN、802.1.qbgVLAN、802.1.qbhVLAN。其中出现较早，应用广泛并且比较成熟的是802.1.qVLAN，其基本原理是在二层协议里插入额外的VLAN协议数据（称为802.1.qVLANTag)，同时保持和传统二层设备的兼容性。Linux里的VLAN设备是对802.1.q协议的一种内部软件实现，模拟现实世界中的802.1.q交换机

**常用操作**

	root@ncloud-compute-20:~# vconfig 
	Expecting argc to be 3-5, inclusive.  Was: 1
	
	Usage: add             [interface-name] [vlan_id]
	       rem             [vlan-name]
	       set_flag        [interface-name] [flag-num]       [0 | 1]
	       set_egress_map  [vlan-name]      [skb_priority]   [vlan_qos]
	       set_ingress_map [vlan-name]      [skb_priority]   [vlan_qos]
	       set_name_type   [name-type]

# 3. TUN/TAP设备

TUN/TAP设备是一种让用户态程序向内核协议栈注入数据的设备，一个工作在三层，一个工作在二层，使用较多的是TAP设备。


    ip tuntap add mode tap
    ip tuntap add mode tun

# 4. VETH

VETH设备出现较早，它的作用是反转通讯数据的方向，需要发送的数据会被转换成需要收到的数据重新送入内核网络层进行处理，从而间接的完成数据的注入。就是完成网线的作用。

    ip link add name veth0 type veth peer name veth1


# 参考资料

1. [linux中的虚拟网络](http://www.ibm.com/developerworks/cn/linux/l-virtual-networking/)

# 变更记录

|Why | Who | When |
|----|-----|------|
|create|fishcired|2014-08-13 |
| 添加tun/tap/veth的创建操作 | fishcired | 2015-07-08 |
